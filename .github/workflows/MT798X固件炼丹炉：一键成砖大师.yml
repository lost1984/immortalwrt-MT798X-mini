name: "MT798Xå›ºä»¶ç‚¼ä¸¹ç‚‰ï¼šä¸€é”®æˆç –å¤§å¸ˆ"

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'é€‰æ‹© OpenWrt ç‰ˆæœ¬'
        required: true
        type: choice
        options:
          - 23.05
          - 24.10
          - lede
        default: '24.10'
      device:
        description: 'é€‰æ‹©è¦ç¼–è¯‘çš„æœºå‹ï¼ˆæ³¨æ„ï¼š23.05 ä¸æ”¯æŒ huasifei_wh3000-emmc å’Œéƒ¨åˆ† usboffload æœºå‹ï¼›24.10 ç‹¬æœ‰æœºå‹åŒ…æ‹¬ huasifei_wh3000-emmcã€cmcc_rax3000m-emmc-usboffloadã€cmcc_rax3000m-usboffloadï¼›Lede æ”¯æŒæ›´å¤šæœºå‹ï¼Œå¦‚ asus_tuf-ax4200ã€xiaomi_redmi-router-ax6000 ç­‰ï¼‰'
        required: true
        type: choice
        options:
          # 23.05 å’Œ 24.10 é€šç”¨æœºå‹
          - abt_asr3000
          - cetron_ct3003
          - cmcc_a10
          - cmcc_rax3000m-emmc
          - cmcc_rax3000m
          - h3c_nx30pro
          - imou_lc-hx3001
          - jcg_q30
          - konka_komi-a31
          - livinet_zr-3020
          - mt7981-360-t7-108M
          - mt7981-clt-r30b1
          - mt7981-clt-r30b1-112M
          - xiaomi_mi-router-ax3000t
          - xiaomi_mi-router-ax3000t-stock
          - xiaomi_mi-router-wr30u-112m
          - xiaomi_mi-router-wr30u-stock
          # 24.10 ç‹¬æœ‰æœºå‹
          - huasifei_wh3000-emmc
          - cmcc_rax3000m-emmc-usboffload
          - cmcc_rax3000m-usboffload
          # Lede ç‹¬æœ‰æœºå‹
          - asus_tuf-ax4200
          - asus_tuf-ax6000
          - bananapi_bpi-r3
          - bananapi_bpi-r3-mini-emmc
          - bananapi_bpi-r3-mini-nand
          - bananapi_bpi-r4
          - bananapi_bpi-r4-poe
          - cetron_ct3003-mod
          - cmcc_a10-mod
          - cmcc_rax3000m-nand
          - cmcc_xr30-nand
          - cudy_tr3000-mod
          - cudy_tr3000-v1
          - fzs_5gcpe-p3
          - glinet_gl-mt2500
          - glinet_gl-mt3000
          - glinet_gl-mt6000
          - glinet_gl-x3000
          - glinet_gl-xe3000
          - h3c_magic-nx30-pro
          - hf_m7986r1-emmc
          - hf_m7986r1-nand
          - jcg_q30-pro
          - jdcloud_re-cs-05
          - mediatek_mt7986a-rfb
          - mediatek_mt7986b-rfb
          - mediatek_mt7988a-rfb
          - netcore_n60
          - netcore_n60-pro
          - nokia_ea0326gmp
          - openembed_som7981
          - qihoo_360t7
          - ruijie_rg-x60-pro
          - tenbay_wr3000k
          - tplink_tl-xdr4288
          - tplink_tl-xdr6086
          - tplink_tl-xdr6088
          - tplink_tl-xtr8488
          - xiaomi_redmi-router-ax6000

permissions:
  contents: write

env:
  BASE_CONFIG_FILE: ${{ github.event.inputs.version == 'lede' && 'Lede.config' || github.event.inputs.version == '23.05' && '2305.config' || '2410.config' }}
  DIY_P1_SH: scripts/diy-part1.sh
  DIY_P2_SH: scripts/diy-part2.sh
  UPLOAD_FIRMWARE: true
  TZ: Asia/Shanghai

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
    - name: æ£€æŸ¥æœºå‹æ”¯æŒæƒ…å†µå¹¶ç¡®å®šç‰ˆæœ¬ã€æºç å’Œæœºå‹
      run: |
        VERSION="${{ github.event.inputs.version }}"
        DEVICE="${{ github.event.inputs.device }}"

        # ç‰ˆæœ¬åˆ‡æ¢
        if [ "$VERSION" == "23.05" ]; then
          case "$DEVICE" in
            "cmcc_rax3000m-usboffload" | "cmcc_rax3000m-emmc-usboffload" | "huasifei_wh3000-emmc")
              echo "23.05 ç‰ˆæœ¬ä¸­ $DEVICE ä¸æ”¯æŒï¼Œè‡ªåŠ¨ä¿®æ­£ä¸º 24.10 æºç "
              VERSION="24.10"
              REPO_URL="https://github.com/padavanonly/immortalwrt-mt798x-24.10"
              REPO_BRANCH="2410"
              BASE_CONFIG_FILE="2410.config"
              ;;
            *)
              REPO_URL="https://github.com/padavanonly/immortalwrt-mt798x-23.05"
              REPO_BRANCH="openwrt-23.05"
              BASE_CONFIG_FILE="2305.config"
              ;;
          esac
        elif [ "$VERSION" == "24.10" ]; then
          REPO_URL="https://github.com/padavanonly/immortalwrt-mt798x-24.10"
          REPO_BRANCH="2410"
          BASE_CONFIG_FILE="2410.config"
        else  # lede
          REPO_URL="https://github.com/coolsnowwolf/lede"
          REPO_BRANCH="master"
          BASE_CONFIG_FILE="Lede.config"
        fi

        # 23.05 å’Œ 24.10 åˆ‡æ¢åˆ° Lede
        LEDE_DEVICES="asus_tuf-ax4200 asus_tuf-ax6000 bananapi_bpi-r3 bananapi_bpi-r3-mini-emmc bananapi_bpi-r3-mini-nand bananapi_bpi-r4 bananapi_bpi-r4-poe cetron_ct3003-mod cmcc_a10-mod cmcc_rax3000m-nand cmcc_xr30-nand cudy_tr3000-mod cudy_tr3000-v1 fzs_5gcpe-p3 glinet_gl-mt2500 glinet_gl-mt3000 glinet_gl-mt6000 glinet_gl-x3000 glinet_gl-xe3000 h3c_magic-nx30-pro hf_m7986r1-emmc hf_m7986r1-nand jcg_q30-pro jdcloud_re-cs-05 mediatek_mt7986a-rfb mediatek_mt7986b-rfb mediatek_mt7988a-rfb netcore_n60 netcore_n60-pro nokia_ea0326gmp openembed_som7981 qihoo_360t7 ruijie_rg-x60-pro tenbay_wr3000k tplink_tl-xdr4288 tplink_tl-xdr6086 tplink_tl-xdr6088 tplink_tl-xtr8488 xiaomi_redmi-router-ax6000"
        if [ "$VERSION" == "23.05" ] || [ "$VERSION" == "24.10" ]; then
          for lede_device in $LEDE_DEVICES; do
            if [ "$DEVICE" == "$lede_device" ]; then
              echo "$VERSION ç‰ˆæœ¬ä¸­ $DEVICE è‡ªåŠ¨ä¿®æ­£ä¸º lede æºç "
              VERSION="lede"
              REPO_URL="https://github.com/coolsnowwolf/lede"
              REPO_BRANCH="master"
              BASE_CONFIG_FILE="Lede.config"
              break
            fi
          done
        fi

        # æœºå‹è½¬æ¢
        if [ "$VERSION" == "24.10" ]; then
          case "$DEVICE" in
            "cmcc_rax3000m-nand")
              DEVICE="cmcc_rax3000m"
              echo "24.10 ç‰ˆæœ¬ä¸­ cmcc_rax3000m-nand è‡ªåŠ¨è½¬æ¢ä¸º cmcc_rax3000m"
              ;;
            "qihoo_360t7")
              DEVICE="mt7981-360-t7-108M"
              echo "24.10 ç‰ˆæœ¬ä¸­ qihoo_360t7 è‡ªåŠ¨è½¬æ¢ä¸º mt7981-360-t7-108M"
              ;;
            "h3c_magic-nx30-pro")
              DEVICE="h3c_nx30pro"
              echo "24.10 ç‰ˆæœ¬ä¸­ h3c_magic-nx30-pro è‡ªåŠ¨è½¬æ¢ä¸º h3c_nx30pro"
              ;;
            "jcg_q30-pro")
              DEVICE="jcg_q30"
              echo "24.10 ç‰ˆæœ¬ä¸­ jcg_q30-pro è‡ªåŠ¨è½¬æ¢ä¸º jcg_q30"
              ;;
          esac
        elif [ "$VERSION" == "lede" ]; then
          case "$DEVICE" in
            "cmcc_rax3000m")
              DEVICE="cmcc_rax3000m-nand"
              echo "lede ç‰ˆæœ¬ä¸­ cmcc_rax3000m è‡ªåŠ¨è½¬æ¢ä¸º cmcc_rax3000m-nand"
              ;;
            "mt7981-360-t7-108M")
              DEVICE="qihoo_360t7"
              echo "lede ç‰ˆæœ¬ä¸­ mt7981-360-t7-108M è‡ªåŠ¨è½¬æ¢ä¸º qihoo_360t7"
              ;;
            "h3c_nx30pro")
              DEVICE="h3c_magic-nx30-pro"
              echo "lede ç‰ˆæœ¬ä¸­ h3c_nx30pro è‡ªåŠ¨è½¬æ¢ä¸º h3c_magic-nx30-pro"
              ;;
            "jcg_q30")
              DEVICE="jcg_q30-pro"
              echo "lede ç‰ˆæœ¬ä¸­ jcg_q30 è‡ªåŠ¨è½¬æ¢ä¸º jcg_q30-pro"
              ;;
          esac
        elif [ "$VERSION" == "23.05" ]; then
          case "$DEVICE" in
            "cmcc_rax3000m-usboffload")
              DEVICE="cmcc_rax3000m"
              echo "è½¬æ¢æœºå‹ï¼šcmcc_rax3000m-usboffload -> cmcc_rax3000m (23.05)"
              ;;
            "cmcc_rax3000m-emmc-usboffload")
              DEVICE="cmcc_rax3000m-emmc"
              echo "è½¬æ¢æœºå‹ï¼šcmcc_rax3000m-emmc-usboffload -> cmcc_rax3000m-emmc (23.05)"
              ;;
          esac
        fi

        # 24.10 ç‰ˆæœ¬ huasifei_wh3000-emmc æç¤º
        if [ "$VERSION" == "24.10" ] && [ "$DEVICE" == "huasifei_wh3000-emmc" ]; then
          echo "è­¦å‘Šï¼šhuasifei_wh3000-emmc æ˜¯ 24.10 çš„æ–°å® ï¼Œäº«å—å§ï¼"
        fi

        # ä¿å­˜ç¯å¢ƒå˜é‡
        echo "VERSION=$VERSION" >> $GITHUB_ENV
        echo "DEVICE=$DEVICE" >> $GITHUB_ENV
        echo "REPO_URL=$REPO_URL" >> $GITHUB_ENV
        echo "REPO_BRANCH=$REPO_BRANCH" >> $GITHUB_ENV
        echo "BASE_CONFIG_FILE=$BASE_CONFIG_FILE" >> $GITHUB_ENV

    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: åˆå§‹åŒ–ç¯å¢ƒ
      env:
        DEBIAN_FRONTEND: noninteractive
      run: |
        sudo rm -rf /etc/apt/sources.list.d/* /usr/share/dotnet /usr/local/lib/android /opt/ghc /opt/hostedtoolcache/CodeQL
        sudo docker image prune --all --force
        for i in {1..3}; do
          sudo -E apt-get -qq update && sudo -E apt-get -qq install -y ack antlr3 asciidoc autoconf automake autopoint binutils bison build-essential \
            bzip2 ccache cmake cpio curl device-tree-compiler fastjar flex gawk gettext gcc-multilib g++-multilib \
            git gperf haveged help2man intltool libc6-dev-i386 libelf-dev libfuse-dev libglib2.0-dev libgmp3-dev \
            libltdl-dev libmpc-dev libmpfr-dev libncurses5-dev libncursesw5-dev libpython3-dev libreadline-dev \
            libssl-dev libtool lrzsz mkisofs msmtp ninja-build p7zip p7zip-full patch pkgconf python2.7 python3 \
            python3-pyelftools python3-setuptools qemu-utils rsync scons squashfs-tools subversion swig texinfo \
            uglifyjs upx-ucl unzip vim wget xmlto xxd zlib1g-dev zip && break
          echo "ä¾èµ–å®‰è£…å¤±è´¥ï¼Œé‡è¯• $i/3..."
          sleep 5
        done
        sudo -E apt-get -qq autoremove --purge
        sudo -E apt-get -qq clean
        sudo timedatectl set-timezone "$TZ"
        sudo mkdir -p /workdir
        sudo chown $USER:$GROUPS /workdir

    - name: å…‹éš†æºç 
      working-directory: /workdir
      run: |
        df -hT $PWD
        for i in {1..3}; do
          git clone $REPO_URL -b $REPO_BRANCH openwrt && break
          echo "å…‹éš†å¤±è´¥ï¼Œé‡è¯• $i/3..."
          sleep 5
        done
        if [ ! -d "openwrt" ]; then
          echo "é”™è¯¯ï¼šå…‹éš†æºç å¤±è´¥"
          exit 1
        fi
        ln -sf /workdir/openwrt $GITHUB_WORKSPACE/openwrt

    - name: è°ƒè¯•ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
      run: |
        ls -la $GITHUB_WORKSPACE/scripts/

    - name: åŠ è½½è‡ªå®šä¹‰ Feeds
      run: |
        cd openwrt
        chmod +x $GITHUB_WORKSPACE/$DIY_P1_SH
        $GITHUB_WORKSPACE/$DIY_P1_SH

    - name: æ›´æ–° Feeds
      run: |
        cd openwrt
        ./scripts/feeds update -a

    - name: å®‰è£… Feeds
      run: |
        cd openwrt
        ./scripts/feeds install -a

    - name: åŠ è½½é…ç½®
      run: |
        cd openwrt
        [ -e $GITHUB_WORKSPACE/files ] && mv $GITHUB_WORKSPACE/files $GITHUB_WORKSPACE/openwrt/files
        if [ -e "$GITHUB_WORKSPACE/$BASE_CONFIG_FILE" ]; then
          cp "$GITHUB_WORKSPACE/$BASE_CONFIG_FILE" .config
        else
          echo "é”™è¯¯ï¼šé…ç½®æ–‡ä»¶ $BASE_CONFIG_FILE ä¸å­˜åœ¨"
          exit 1
        fi
        if [ "${{ github.event.inputs.version }}" == "lede" ]; then
          # æ›¿æ¢ Lede.config ä¸­çš„ç›®æ ‡è®¾å¤‡é…ç½®
          sed -i "/CONFIG_TARGET_mediatek_filogic_DEVICE_/d" .config
          echo "CONFIG_TARGET_mediatek_filogic_DEVICE_$DEVICE=y" >> .config
          # æ›´æ–° TARGET_PROFILE
          sed -i "s/CONFIG_TARGET_PROFILE=\"DEVICE_.*\"/CONFIG_TARGET_PROFILE=\"DEVICE_$DEVICE\"/" .config
        else
          # å¤„ç† 23.05 å’Œ 24.10 çš„é…ç½®
          sed -i "/CONFIG_TARGET_DEVICE_mediatek_mt7981_DEVICE_/d" .config
          echo "CONFIG_TARGET_DEVICE_mediatek_mt7981_DEVICE_$DEVICE=y" >> .config
          echo "CONFIG_TARGET_DEVICE_PACKAGES_mediatek_mt7981_DEVICE_$DEVICE=\"\"" >> .config
        fi
        make defconfig

    - name: æ£€æŸ¥é…ç½®
      id: check_config
      run: |
        cd openwrt
        if [ "${{ github.event.inputs.version }}" == "lede" ]; then
          if grep -q "CONFIG_TARGET_mediatek_filogic_DEVICE_${DEVICE}=y" .config && grep -q "CONFIG_TARGET_PROFILE=\"DEVICE_${DEVICE}\"" .config; then
            echo "é…ç½®æ£€æŸ¥é€šè¿‡ï¼šç›®æ ‡è®¾å¤‡ $DEVICE å·²æ­£ç¡®é…ç½® (Lede)"
            echo "config_status=success" >> $GITHUB_OUTPUT
          else
            echo "é”™è¯¯ï¼šé…ç½®æ£€æŸ¥å¤±è´¥ï¼Œæœªæ‰¾åˆ°ç›®æ ‡è®¾å¤‡ $DEVICE çš„é…ç½®æˆ– PROFILE æœªæ­£ç¡®è®¾ç½® (Lede)"
            exit 1
          fi
        else
          if grep -q "CONFIG_TARGET_DEVICE_mediatek_mt7981_DEVICE_${DEVICE}=y" .config; then
            echo "é…ç½®æ£€æŸ¥é€šè¿‡ï¼šç›®æ ‡è®¾å¤‡ $DEVICE å·²æ­£ç¡®é…ç½®"
            echo "config_status=success" >> $GITHUB_OUTPUT
          else
            echo "é”™è¯¯ï¼šé…ç½®æ£€æŸ¥å¤±è´¥ï¼Œæœªæ‰¾åˆ°ç›®æ ‡è®¾å¤‡ $DEVICE çš„é…ç½®"
            exit 1
          fi
        fi

    - name: æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬
      if: steps.check_config.outputs.config_status == 'success'
      run: |
        cd openwrt
        chmod +x $GITHUB_WORKSPACE/$DIY_P2_SH
        $GITHUB_WORKSPACE/$DIY_P2_SH

    - name: ä¸‹è½½è½¯ä»¶åŒ…
      if: steps.check_config.outputs.config_status == 'success'
      run: |
        cd openwrt
        make download -j8
        find dl -size -1024c -exec ls -l {} \;
        find dl -size -1024c -exec rm -f {} \;

    - name: ç¼–è¯‘å›ºä»¶
      id: compile
      if: steps.check_config.outputs.config_status == 'success'
      run: |
        cd openwrt
        df -hT
        FREE_SPACE=$(df -hT . | tail -1 | awk '{print $4}' | grep -o '[0-9]\+')
        if [ "$FREE_SPACE" -lt 10 ]; then
          echo "é”™è¯¯ï¼šç£ç›˜ç©ºé—´ä¸è¶³ï¼ˆå‰©ä½™ ${FREE_SPACE}Gï¼‰ï¼Œéœ€è¦è‡³å°‘ 10G"
          exit 1
        fi
        echo -e "$(nproc) thread compile for $DEVICE"
        make -j$(nproc) V=s || make -j1 V=s
        echo "status=success" >> $GITHUB_OUTPUT
        echo "FILE_DATE=_$(date +"%Y%m%d%H%M")" >> $GITHUB_ENV

    - name: æ£€æŸ¥ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
      if: steps.check_config.outputs.config_status == 'success' && !cancelled()
      run: df -hT

    - name: æ•´ç†æ–‡ä»¶å¹¶å‹ç¼©ä¸º ZIP
      id: organize
      if: steps.check_config.outputs.config_status == 'success' && env.UPLOAD_FIRMWARE == 'true' && !cancelled()
      run: |
        cd openwrt/bin/targets/*/*
        rm -rf packages
        FIRMWARE_DIR=$PWD
        echo "å›ºä»¶ç›®å½•: $FIRMWARE_DIR"
        echo "FIRMWARE=$FIRMWARE_DIR" >> $GITHUB_ENV

        if ls $FIRMWARE_DIR/*sysupgrade.bin $FIRMWARE_DIR/*factory.bin >/dev/null 2>&1; then
          for bin_file in *sysupgrade.bin *factory.bin; do
            zip_filename="${bin_file%.bin}${FILE_DATE}.zip"
            zip -r "$zip_filename" "$bin_file"
            echo "å·²å‹ç¼©ä¸º: $zip_filename"
          done
          echo "status=success" >> $GITHUB_OUTPUT
        else
          echo "é”™è¯¯ï¼šæœªæ‰¾åˆ° $DEVICE çš„ sysupgrade.bin æˆ– factory.bin å›ºä»¶ï¼Œé€€å‡º"
          exit 1
        fi

    - name: ä¸Šä¼ å›ºä»¶ç›®å½•
      uses: actions/upload-artifact@v4
      if: steps.check_config.outputs.config_status == 'success' && steps.organize.outputs.status == 'success' && !cancelled()
      with:
        name: OpenWrt_firmware_${{ github.event.inputs.version }}_${{ env.DEVICE }}${{ env.FILE_DATE }}
        path: ${{ env.FIRMWARE }}

    - name: æ¸…ç†ä¸éœ€è¦çš„æ–‡ä»¶
      if: steps.check_config.outputs.config_status == 'success' && steps.organize.outputs.status == 'success' && !cancelled()
      run: |
        echo "æ¸…ç† ${FIRMWARE} ç›®å½•ä¸‹çš„ kernel.bin å’Œ .zip æ–‡ä»¶..."
        find ${{ env.FIRMWARE }} -type f -name "*kernel.bin" -exec rm -v {} \;
        find ${{ env.FIRMWARE }} -type f -name "*.zip" -exec rm -v {} \;
        echo "æ¸…ç†å®Œæˆï¼Œå½“å‰ç›®å½•å†…å®¹ï¼š"
        ls -lh ${{ env.FIRMWARE }}

    - name: å‘å¸ƒå›ºä»¶ï¼šç –å‚å¤§å¸ˆçš„æœ€æ–°æ°ä½œ
      if: steps.check_config.outputs.config_status == 'success' && steps.organize.outputs.status == 'success' && !cancelled()
      uses: softprops/action-gh-release@v1
      with:
        tag_name: "v${{ github.event.inputs.version }}_${{ env.DEVICE }}_${{ env.FILE_DATE }}"
        name: "MT798X å›ºä»¶ ${{ github.event.inputs.version }} - ${{ env.DEVICE }}"
        body: |
          ğŸ‰ **MT798X å›ºä»¶å‘å¸ƒï¼šç –å‚å¤§å¸ˆçš„æœ€æ–°æ°ä½œï¼** ğŸ‰  
          ç»è¿‡æ— æ•°æ¬¡â€œçƒ§ç –â€å®éªŒï¼Œè¿™æ¬¾å›ºä»¶ç»ˆäºé—®ä¸–ï¼  
          - **ç‰ˆæœ¬**ï¼š${{ github.event.inputs.version }}  
          - **æœºå‹**ï¼š${{ env.DEVICE }}  
          - **ç®¡ç†åœ°å€**ï¼š192.168.2.1  
          - **é»˜è®¤ç”¨æˆ·å**ï¼šroot  
          - **é»˜è®¤å¯†ç **ï¼š${{ github.event.inputs.version == 'lede' && 'password' || 'ç©º' }}  
          - **æºç æ¥æº**ï¼š${{ github.event.inputs.version == 'lede' && 'https://github.com/coolsnowwolf/lede' || (github.event.inputs.version == '23.05' && 'https://github.com/padavanonly/immortalwrt-mt798x-23.05' || 'https://github.com/padavanonly/immortalwrt-mt798x-24.10') }}  
          - **å†…æ ¸ç‰ˆæœ¬**ï¼š${{ github.event.inputs.version == 'lede' && '5.15ï¼ˆå…·ä½“ç‰ˆæœ¬å¯èƒ½éš Lede æ›´æ–°è€Œå˜åŒ–ï¼‰' || (github.event.inputs.version == '23.05' && '5.4.255' || '5.4.284') }}  
          - **æ„Ÿè°¢**ï¼šæ„Ÿè°¢ padavanonly å’Œ coolsnowwolf çš„å¼€æºè´¡çŒ®ï¼  
          - **ç‰¹åˆ«è¯´æ˜**ï¼š  
            - æœ¬å‘å¸ƒä»…åŒ…å« `sysupgrade.bin` å’Œ `factory.bin` æ–‡ä»¶ï¼Œ`kernel.bin` å’Œ `.zip` æ–‡ä»¶å·²ç§»é™¤ã€‚  
            - å¦‚æœä½ çš„è·¯ç”±å™¨å˜ç –äº†ï¼Œåˆ«æ€ªæˆ‘ï¼Œå¯èƒ½æ˜¯å®ƒè‡ªå·±æƒ³é€€ä¼‘äº†ï¼  
          - **ä½¿ç”¨å»ºè®®**ï¼š  
            1. åˆ·æœºå‰è¯·å¤‡ä»½åŸå›ºä»¶ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚  
            2. ä½¿ç”¨ `sysupgrade.bin` è¿›è¡Œç³»ç»Ÿå‡çº§ï¼Œ`factory.bin` ç”¨äºæ¢å¤å‡ºå‚è®¾ç½®ã€‚  
            3. åˆ·æœºåè¯·æ£€æŸ¥ç®¡ç†åœ°å€å’Œå¯†ç æ˜¯å¦æ­£ç¡®ã€‚  
            4. å¦‚æœåˆ·æœºå¤±è´¥æˆ–å˜ç –ï¼Œè¯·å°è¯•æ¢å¤ï¼Œæˆ–åœ¨ Issues ä¸­åé¦ˆï¼ˆé™„ä¸Šæ—¥å¿—ï¼‰ã€‚  
          å¿«æ¥ä¸‹è½½ä½“éªŒå§ï¼ŒMT798X çš„â€œé­”æ³•â€åœ¨å¬å”¤ä½ ï¼  
        files: |
          ${{ env.FIRMWARE }}/*sysupgrade.bin
          ${{ env.FIRMWARE }}/*factory.bin
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: ä¸Šä¼ å›ºä»¶åˆ°ç§æœ‰ WebDAV
      if: steps.compile.outputs.status == 'success' && steps.organize.outputs.status == 'success' && !cancelled()
      run: |
        # æ£€æŸ¥ WebDAV é…ç½®æ˜¯å¦å®Œæ•´
        if [ -z "${{ secrets.WEBDAV_URL }}" ] || [ -z "${{ secrets.WEBDAV_USER }}" ] || [ -z "${{ secrets.WEBDAV_PASSWORD }}" ]; then
          echo "âš ï¸ WebDAV é…ç½®ä¸å®Œæ•´ï¼ˆç¼ºå°‘ WEBDAV_URLã€WEBDAV_USER æˆ– WEBDAV_PASSWORDï¼‰ï¼Œè·³è¿‡ä¸Šä¼ åˆ° WebDAV"
        else
          # å¦‚æœé…ç½®å®Œæ•´ï¼Œåˆ™æ‰§è¡Œä¸Šä¼ 
          for file in ${{ env.FIRMWARE }}/*.zip; do
            echo "ä¸Šä¼  $file åˆ° WebDAV..."
            curl -u ${{ secrets.WEBDAV_USER }}:${{ secrets.WEBDAV_PASSWORD }} \
              -T "$file" \
              "${{ secrets.WEBDAV_URL }}/${{ github.event.inputs.version }}/${{ env.DEVICE }}/$(basename $file)" || {
                echo "âš ï¸ ä¸Šä¼  $file å¤±è´¥ï¼Œä½†å°†ç»§ç»­å¤„ç†å…¶ä»–æ–‡ä»¶"
              }
            echo "æˆåŠŸä¸Šä¼ : $file"
          done
        fi
